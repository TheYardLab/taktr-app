"use strict";exports.id=831,exports.ids=[831],exports.modules={9831:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{default:()=>d});var r=a(997),i=a(6689),l=a(252),n=a(1492),o=e([l,n]);[l,n]=o.then?(await o)():o;let h=e=>{if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:new Date(t.getFullYear(),t.getMonth(),t.getDate())},m=e=>new Date(e.getFullYear(),e.getMonth(),e.getDate()),c=(e,t)=>Math.max(1,Math.floor((m(t).getTime()-m(e).getTime())/864e5)+1),x=(e,t)=>new Date(e.getFullYear(),e.getMonth(),e.getDate()+t);function d({projectId:e}){let[t,a]=(0,i.useState)([]),[s,o]=(0,i.useState)({zones:[],trades:[],taktDays:5}),d=async t=>{if(!e)return;let a=(0,n.doc)(l.db,"projects",e,"taktMeta","meta");await (0,n.setDoc)(a,t,{merge:!0})},g=async()=>{let e=(prompt("Add Zone name")||"").trim();if(!e)return;let t=Array.from(new Set([...s.zones||[],e]));o(e=>({...e,zones:t})),await d({zones:t})},p=async e=>{let t=(s.zones||[]).filter(t=>t!==e);o(e=>({...e,zones:t})),await d({zones:t})},u=async()=>{let e=(prompt("Add Trade name")||"").trim();if(!e)return;let t=Array.from(new Set([...s.trades||[],e]));o(e=>({...e,trades:t})),await d({trades:t})},f=async e=>{let t=(s.trades||[]).filter(t=>t!==e);o(e=>({...e,trades:t})),await d({trades:t})},b=async e=>{let t=Math.max(1,Math.min(30,Math.floor(e)));o(e=>({...e,taktDays:t})),await d({taktDays:t})},[y,w]=(0,i.useState)(30),j=(0,i.useRef)(null),{start:v,end:N}=(0,i.useMemo)(()=>{let e=[],a=[];for(let s of t){let t=h(s.startDate),r=h(s.endDate);t&&e.push(m(t)),r&&a.push(m(r))}let s=e.length?new Date(Math.min(...e.map(e=>e.getTime()))):m(new Date),r=a.length?new Date(Math.max(...a.map(e=>e.getTime()))):m(new Date);return 21>c(s,r)&&r.setDate(r.getDate()+(21-c(s,r))),{start:s,end:r}},[t]),M=(0,i.useMemo)(()=>Array.from({length:c(v,N)},(e,t)=>x(v,t)),[v,N]),T=(0,i.useMemo)(()=>{let e=new Map;for(let t of s.zones||[])t&&!e.has(t)&&e.set(t,[]);for(let a of t){let t=(a.zone||"Unzoned").trim();e.has(t)||e.set(t,[]),e.get(t).push(a)}let a=[];for(let[t,s]of e){let e=s.map(e=>{let t=h(e.startDate),a=h(e.endDate);return t&&a?{id:e.id,s:t,e:a,key:(e.trade||"Unassigned").trim()}:null}).filter(Boolean),{laneByTask:r,laneCount:i}=function(e){let t=[...e].sort((e,t)=>e.s.getTime()-t.s.getTime()||e.e.getTime()-t.e.getTime()),a=[],s=new Map;for(let e of t){let t=0;for(;t<a.length&&a[t].getTime()>=e.s.getTime();)t++;t===a.length?a.push(e.e):a[t]=e.e,s.set(e.id,t)}return{laneByTask:s,laneCount:a.length}}(e),l=new Map(r),n=38*Math.max(1,i);a.push({name:t,tasks:s,laneById:l,laneCount:Math.max(1,i),height:n})}return a.sort((e,t)=>e.name.localeCompare(t.name)),a},[t,s.zones]),D=44+T.reduce((e,t)=>e+t.height,0),k=Math.max(1e3,M.length*y+180),z=(0,i.useMemo)(()=>{let e=[],t=44;for(let a of T)e.push(t),t+=a.height;return e},[T,44]),S=(()=>{let e=Math.floor((m(new Date).getTime()-v.getTime())/864e5);return 180+e*y})(),A=e=>{w(t=>Math.max(16,Math.min(80,t+e))),requestAnimationFrame(()=>{j.current?.scrollBy({left:10*e,behavior:"instant"})})};return(0,r.jsxs)("div",{className:"relative rounded border bg-white",style:{resize:"both",overflow:"auto",minWidth:1100,minHeight:600,padding:12},ref:j,children:[(0,r.jsxs)("div",{className:"mb-2 flex items-center justify-between text-sm text-gray-600",children:[(0,r.jsxs)("div",{children:[r.jsx("strong",{children:"Takt Plan"})," ",(0,r.jsxs)("span",{className:"ml-2",children:["Zones: ",Math.max(T.length,(s.zones||[]).length)," • Trades: ",new Set(t.map(e=>(e.trade||"Unassigned").trim())).size," •"," ","Takt: ",s.taktDays," days"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("button",{className:"rounded border px-2 py-0.5 text-xs",onClick:()=>A(-6),title:"Zoom out",children:"−"}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["Day width: ",y,"px"]}),r.jsx("button",{className:"rounded border px-2 py-0.5 text-xs",onClick:()=>A(6),title:"Zoom in",children:"+"})]})]}),(0,r.jsxs)("div",{className:"mb-3 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[(0,r.jsxs)("div",{className:"rounded border p-2 bg-gray-50",children:[r.jsx("div",{className:"mb-2 font-medium text-gray-700",children:"Zones"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:(s.zones||[]).map(e=>(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 rounded border bg-white px-2 py-0.5",children:[e,r.jsx("button",{className:"text-xs text-red-600",title:"Remove",onClick:()=>p(e),children:"\xd7"})]},e))}),r.jsx("button",{className:"mt-2 rounded border px-2 py-1",onClick:g,children:"+ Add Zone"})]}),(0,r.jsxs)("div",{className:"rounded border p-2 bg-gray-50",children:[r.jsx("div",{className:"mb-2 font-medium text-gray-700",children:"Trades"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:(s.trades||[]).map(e=>(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 rounded border bg-white px-2 py-0.5",children:[e,r.jsx("button",{className:"text-xs text-red-600",title:"Remove",onClick:()=>f(e),children:"\xd7"})]},e))}),r.jsx("button",{className:"mt-2 rounded border px-2 py-1",onClick:u,children:"+ Add Trade"}),(0,r.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[r.jsx("label",{className:"text-gray-700",children:"Takt (days):"}),r.jsx("input",{type:"number",min:1,max:30,value:s.taktDays,onChange:e=>b(parseInt(e.target.value||"5",10)),className:"w-20 rounded border px-2 py-1"})]})]})]}),(0,r.jsxs)("div",{className:"relative overflow-auto border rounded",style:{background:"#fff",width:k,height:D},"data-export-width":k,"data-export-height":D,children:[r.jsx("div",{className:"sticky left-0 top-0 z-20 border-b border-r bg-white",style:{width:180,height:44,display:"flex",alignItems:"center",paddingLeft:10},children:r.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Zone"})}),r.jsx("div",{className:"sticky top-0 z-10 border-b bg-white",style:{marginLeft:180,height:44,width:k-180},children:r.jsx("div",{style:{position:"relative",height:"100%"},children:M.map((e,t)=>{let a=1===e.getDay();return r.jsx("div",{style:{position:"absolute",left:t*y,top:0,width:y,height:44,borderLeft:`1px solid ${a?"#cbd5e1":"#e5e7eb"}`},children:r.jsx("div",{style:{position:"absolute",bottom:6,left:4,fontSize:10,color:"#6b7280",fontWeight:a?600:400},children:`${e.getMonth()+1}/${e.getDate()}`})},t)})})}),(0,r.jsxs)("div",{style:{width:180},children:[r.jsx("div",{style:{height:44}}),T.map((e,t)=>r.jsx("div",{className:"border-r",style:{height:e.height,display:"flex",alignItems:"center",paddingLeft:10,borderBottom:"1px solid #f1f5f9",position:"relative",background:t%2?"#fafafa":"#fff"},children:r.jsx("span",{className:"text-xs font-medium text-gray-700 truncate",children:e.name})},e.name))]}),(0,r.jsxs)("div",{style:{position:"absolute",top:0,left:180,width:k-180,height:D},children:[(0,r.jsxs)("div",{style:{position:"absolute",top:44,left:0,right:0,bottom:0},children:[M.map((e,t)=>r.jsx("div",{style:{position:"absolute",left:t*y,top:0,bottom:0,width:0,borderLeft:`1px solid ${1===e.getDay()?"#cbd5e1":"#f1f5f9"}`}},t)),r.jsx("div",{style:{position:"absolute",left:S-180,top:0,bottom:0,width:0,borderLeft:"2px dashed #ef4444"},title:"Today"})]}),r.jsx("div",{style:{position:"absolute",top:44,left:0,right:0},children:T.map((e,t)=>{let a=z[t],s=e.height/e.laneCount;return(0,r.jsxs)("div",{style:{position:"absolute",left:0,right:0,top:a-44,height:e.height},children:[e.tasks.map(t=>{let a=h(t.startDate),i=h(t.endDate);if(!a||!i)return null;let l=Math.max(0,Math.floor((a.getTime()-v.getTime())/864e5)),n=c(a,i),o=e.laneById.get(t.id)??0,d=(t.trade?`${t.trade} • `:"")+(t.name||"")+(t.subcontractor?` • ${t.subcontractor}`:""),m=function(e){let t=0;for(let a=0;a<e.length;a++)t=31*t+e.charCodeAt(a)|0;return Math.abs(t)%360}(t.trade||"Unassigned"),x=`hsl(${m} 85% 88%)`,g=`hsl(${m} 70% 45%)`;return r.jsx("div",{title:d,style:{position:"absolute",left:l*y+2,top:o*s+6,height:s-12,width:Math.max(14,n*y-4),background:x,border:`1px solid ${g}`,borderRadius:6,overflow:"hidden",display:"flex",alignItems:"center",boxShadow:"0 1px 0 rgba(0,0,0,0.04)"},children:r.jsx("div",{style:{fontSize:11,lineHeight:1.1,color:"#111827",padding:"0 6px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",width:"100%",fontWeight:500},children:d})},t.id)}),r.jsx("div",{style:{position:"absolute",left:0,right:0,bottom:-1,borderBottom:"1px solid #e5e7eb"}})]},e.name)})})]})]}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["Tip: Use +/− to zoom the day width. Drag the lower-right handle to resize. Bars show",r.jsx("em",{children:" Trade • Task • Subcontractor"}),". Zones are listed on the left; overlapping work stacks into lanes to resemble trains/wagons."]}),r.jsx("script",{dangerouslySetInnerHTML:{__html:`
          ;(function(){
            window.__TAKTR_GET_EXPORT_SIZE = function(){
              var el = document.querySelector('[data-export-width][data-export-height]');
              if(!el) return null;
              return { w: Number(el.getAttribute('data-export-width')), h: Number(el.getAttribute('data-export-height')) };
            };
          })();`}})]})}s()}catch(e){s(e)}})}};