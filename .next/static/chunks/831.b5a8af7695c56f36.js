"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[831],{9831:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var s=a(5893),n=a(7294),r=a(252),l=a(9828);function i(e){if(!e)return"";if("string"==typeof e)return e.split("T")[0]||e;if("number"==typeof(null==e?void 0:e.seconds))return new Date(1e3*e.seconds).toISOString().slice(0,10);let t=new Date(e);return Number.isNaN(t.getTime())?"":t.toISOString().slice(0,10)}let o=e=>{if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:new Date(t.getFullYear(),t.getMonth(),t.getDate())},d=e=>new Date(e.getFullYear(),e.getMonth(),e.getDate()),h=(e,t)=>Math.max(1,Math.floor((d(t).getTime()-d(e).getTime())/864e5)+1),c=(e,t)=>new Date(e.getFullYear(),e.getMonth(),e.getDate()+t);function m(e){let{projectId:t}=e,[a,m]=(0,n.useState)([]),[u,g]=(0,n.useState)({zones:[],trades:[],taktDays:5});(0,n.useEffect)(()=>{if(!t)return;let e=(0,l.JU)(r.db,"projects",t,"taktMeta","meta"),a=(0,l.cf)(e,e=>{let t=e.data();g({zones:Array.isArray(null==t?void 0:t.zones)?t.zones:[],trades:Array.isArray(null==t?void 0:t.trades)?t.trades:[],taktDays:"number"==typeof(null==t?void 0:t.taktDays)?t.taktDays:5})},()=>{g({zones:[],trades:[],taktDays:5})});return()=>a()},[t]);let p=async e=>{if(!t)return;let a=(0,l.JU)(r.db,"projects",t,"taktMeta","meta");await (0,l.pl)(a,e,{merge:!0})},x=async()=>{let e=(prompt("Add Zone name")||"").trim();if(!e)return;let t=Array.from(new Set([...u.zones||[],e]));g(e=>({...e,zones:t})),await p({zones:t})},f=async e=>{let t=(u.zones||[]).filter(t=>t!==e);g(e=>({...e,zones:t})),await p({zones:t})},b=async()=>{let e=(prompt("Add Trade name")||"").trim();if(!e)return;let t=Array.from(new Set([...u.trades||[],e]));g(e=>({...e,trades:t})),await p({trades:t})},y=async e=>{let t=(u.trades||[]).filter(t=>t!==e);g(e=>({...e,trades:t})),await p({trades:t})},v=async e=>{let t=Math.max(1,Math.min(30,Math.floor(e)));g(e=>({...e,taktDays:t})),await p({taktDays:t})},[w,j]=(0,n.useState)(30),N=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(!t)return;let e=(0,l.hJ)(r.db,"projects",t,"tasks"),a=(0,l.cf)(e,e=>{let t=[];e.forEach(e=>{var a,s,n,r,l,o,d,h,c;let m=e.data();t.push({id:e.id,name:String(m.name||m.task||""),trade:null!==(a=m.trade)&&void 0!==a?a:null,subcontractor:null!==(s=m.subcontractor)&&void 0!==s?s:null,status:null!==(n=m.status)&&void 0!==n?n:null,startDate:i(null!==(l=null!==(r=m.startDate)&&void 0!==r?r:m.start)&&void 0!==l?l:m.plannedStart),endDate:i(null!==(d=null!==(o=m.endDate)&&void 0!==o?o:m.finish)&&void 0!==d?d:m.plannedFinish),zone:(null!==(c=null!==(h=m.zone)&&void 0!==h?h:m.area)&&void 0!==c?c:null)||null})}),m(t)});return()=>a()},[t]);let{start:D,end:k}=(0,n.useMemo)(()=>{let e=[],t=[];for(let s of a){let a=o(s.startDate),n=o(s.endDate);a&&e.push(d(a)),n&&t.push(d(n))}let s=e.length?new Date(Math.min(...e.map(e=>e.getTime()))):d(new Date),n=t.length?new Date(Math.max(...t.map(e=>e.getTime()))):d(new Date);return 21>h(s,n)&&n.setDate(n.getDate()+(21-h(s,n))),{start:s,end:n}},[a]),T=(0,n.useMemo)(()=>Array.from({length:h(D,k)},(e,t)=>c(D,t)),[D,k]),M=(0,n.useMemo)(()=>{let e=new Map;for(let t of u.zones||[])t&&!e.has(t)&&e.set(t,[]);for(let t of a){let a=(t.zone||"Unzoned").trim();e.has(a)||e.set(a,[]),e.get(a).push(t)}let t=[];for(let[a,s]of e){let{laneByTask:e,laneCount:n}=function(e){let t=[...e].sort((e,t)=>e.s.getTime()-t.s.getTime()||e.e.getTime()-t.e.getTime()),a=[],s=new Map;for(let e of t){let t=0;for(;t<a.length&&a[t].getTime()>=e.s.getTime();)t++;t===a.length?a.push(e.e):a[t]=e.e,s.set(e.id,t)}return{laneByTask:s,laneCount:a.length}}(s.map(e=>{let t=o(e.startDate),a=o(e.endDate);return t&&a?{id:e.id,s:t,e:a,key:(e.trade||"Unassigned").trim()}:null}).filter(Boolean)),r=new Map(e),l=38*Math.max(1,n);t.push({name:a,tasks:s,laneById:r,laneCount:Math.max(1,n),height:l})}return t.sort((e,t)=>e.name.localeCompare(t.name)),t},[a,u.zones]),z=44+M.reduce((e,t)=>e+t.height,0),S=Math.max(1e3,T.length*w+180),A=(0,n.useMemo)(()=>{let e=[],t=44;for(let a of M)e.push(t),t+=a.height;return e},[M,44]),C=180+Math.floor((d(new Date).getTime()-D.getTime())/864e5)*w,_=e=>{j(t=>Math.max(16,Math.min(80,t+e))),requestAnimationFrame(()=>{var t;null===(t=N.current)||void 0===t||t.scrollBy({left:10*e,behavior:"instant"})})};return(0,s.jsxs)("div",{className:"relative rounded border bg-white",style:{resize:"both",overflow:"auto",minWidth:1100,minHeight:600,padding:12},ref:N,children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center justify-between text-sm text-gray-600",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Takt Plan"})," ",(0,s.jsxs)("span",{className:"ml-2",children:["Zones: ",Math.max(M.length,(u.zones||[]).length)," • Trades: ",new Set(a.map(e=>(e.trade||"Unassigned").trim())).size," •"," ","Takt: ",u.taktDays," days"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"rounded border px-2 py-0.5 text-xs",onClick:()=>_(-6),title:"Zoom out",children:"−"}),(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:["Day width: ",w,"px"]}),(0,s.jsx)("button",{className:"rounded border px-2 py-0.5 text-xs",onClick:()=>_(6),title:"Zoom in",children:"+"})]})]}),(0,s.jsxs)("div",{className:"mb-3 grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[(0,s.jsxs)("div",{className:"rounded border p-2 bg-gray-50",children:[(0,s.jsx)("div",{className:"mb-2 font-medium text-gray-700",children:"Zones"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:(u.zones||[]).map(e=>(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 rounded border bg-white px-2 py-0.5",children:[e,(0,s.jsx)("button",{className:"text-xs text-red-600",title:"Remove",onClick:()=>f(e),children:"\xd7"})]},e))}),(0,s.jsx)("button",{className:"mt-2 rounded border px-2 py-1",onClick:x,children:"+ Add Zone"})]}),(0,s.jsxs)("div",{className:"rounded border p-2 bg-gray-50",children:[(0,s.jsx)("div",{className:"mb-2 font-medium text-gray-700",children:"Trades"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:(u.trades||[]).map(e=>(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 rounded border bg-white px-2 py-0.5",children:[e,(0,s.jsx)("button",{className:"text-xs text-red-600",title:"Remove",onClick:()=>y(e),children:"\xd7"})]},e))}),(0,s.jsx)("button",{className:"mt-2 rounded border px-2 py-1",onClick:b,children:"+ Add Trade"}),(0,s.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,s.jsx)("label",{className:"text-gray-700",children:"Takt (days):"}),(0,s.jsx)("input",{type:"number",min:1,max:30,value:u.taktDays,onChange:e=>v(parseInt(e.target.value||"5",10)),className:"w-20 rounded border px-2 py-1"})]})]})]}),(0,s.jsxs)("div",{className:"relative overflow-auto border rounded",style:{background:"#fff",width:S,height:z},"data-export-width":S,"data-export-height":z,children:[(0,s.jsx)("div",{className:"sticky left-0 top-0 z-20 border-b border-r bg-white",style:{width:180,height:44,display:"flex",alignItems:"center",paddingLeft:10},children:(0,s.jsx)("span",{className:"text-xs font-semibold text-gray-700",children:"Zone"})}),(0,s.jsx)("div",{className:"sticky top-0 z-10 border-b bg-white",style:{marginLeft:180,height:44,width:S-180},children:(0,s.jsx)("div",{style:{position:"relative",height:"100%"},children:T.map((e,t)=>{let a=1===e.getDay();return(0,s.jsx)("div",{style:{position:"absolute",left:t*w,top:0,width:w,height:44,borderLeft:"1px solid ".concat(a?"#cbd5e1":"#e5e7eb")},children:(0,s.jsx)("div",{style:{position:"absolute",bottom:6,left:4,fontSize:10,color:"#6b7280",fontWeight:a?600:400},children:"".concat(e.getMonth()+1,"/").concat(e.getDate())})},t)})})}),(0,s.jsxs)("div",{style:{width:180},children:[(0,s.jsx)("div",{style:{height:44}}),M.map((e,t)=>(0,s.jsx)("div",{className:"border-r",style:{height:e.height,display:"flex",alignItems:"center",paddingLeft:10,borderBottom:"1px solid #f1f5f9",position:"relative",background:t%2?"#fafafa":"#fff"},children:(0,s.jsx)("span",{className:"text-xs font-medium text-gray-700 truncate",children:e.name})},e.name))]}),(0,s.jsxs)("div",{style:{position:"absolute",top:0,left:180,width:S-180,height:z},children:[(0,s.jsxs)("div",{style:{position:"absolute",top:44,left:0,right:0,bottom:0},children:[T.map((e,t)=>(0,s.jsx)("div",{style:{position:"absolute",left:t*w,top:0,bottom:0,width:0,borderLeft:"1px solid ".concat(1===e.getDay()?"#cbd5e1":"#f1f5f9")}},t)),(0,s.jsx)("div",{style:{position:"absolute",left:C-180,top:0,bottom:0,width:0,borderLeft:"2px dashed #ef4444"},title:"Today"})]}),(0,s.jsx)("div",{style:{position:"absolute",top:44,left:0,right:0},children:M.map((e,t)=>{let a=A[t],n=e.height/e.laneCount;return(0,s.jsxs)("div",{style:{position:"absolute",left:0,right:0,top:a-44,height:e.height},children:[e.tasks.map(t=>{var a;let r=o(t.startDate),l=o(t.endDate);if(!r||!l)return null;let i=Math.max(0,Math.floor((r.getTime()-D.getTime())/864e5)),d=h(r,l),c=null!==(a=e.laneById.get(t.id))&&void 0!==a?a:0,m=(t.trade?"".concat(t.trade," • "):"")+(t.name||"")+(t.subcontractor?" • ".concat(t.subcontractor):""),u=function(e){let t=0;for(let a=0;a<e.length;a++)t=31*t+e.charCodeAt(a)|0;return Math.abs(t)%360}(t.trade||"Unassigned");return(0,s.jsx)("div",{title:m,style:{position:"absolute",left:i*w+2,top:c*n+6,height:n-12,width:Math.max(14,d*w-4),background:"hsl(".concat(u," 85% 88%)"),border:"1px solid ".concat("hsl(".concat(u," 70% 45%)")),borderRadius:6,overflow:"hidden",display:"flex",alignItems:"center",boxShadow:"0 1px 0 rgba(0,0,0,0.04)"},children:(0,s.jsx)("div",{style:{fontSize:11,lineHeight:1.1,color:"#111827",padding:"0 6px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",width:"100%",fontWeight:500},children:m})},t.id)}),(0,s.jsx)("div",{style:{position:"absolute",left:0,right:0,bottom:-1,borderBottom:"1px solid #e5e7eb"}})]},e.name)})})]})]}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["Tip: Use +/− to zoom the day width. Drag the lower-right handle to resize. Bars show",(0,s.jsx)("em",{children:" Trade • Task • Subcontractor"}),". Zones are listed on the left; overlapping work stacks into lanes to resemble trains/wagons."]}),(0,s.jsx)("script",{dangerouslySetInnerHTML:{__html:"\n          ;(function(){\n            window.__TAKTR_GET_EXPORT_SIZE = function(){\n              var el = document.querySelector('[data-export-width][data-export-height]');\n              if(!el) return null;\n              return { w: Number(el.getAttribute('data-export-width')), h: Number(el.getAttribute('data-export-height')) };\n            };\n          })();"}})]})}}}]);