"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[853],{4853:function(e,t,n){n.r(t),n.d(t,{default:function(){return c}});var a=n(5893),s=n(7294),l=n(1225),r=n(9828);function i(e){if(e){if("string"==typeof e){let t=new Date(e);return Number.isNaN(t.getTime())?void 0:t}if(e instanceof Date)return e;if("number"==typeof e.seconds)return new Date(1e3*e.seconds)}}function o(e){let t=new Date(e);return t.setHours(0,0,0,0),t}function d(e){return o(e).toISOString().slice(0,10)}function c(e){let{tasks:t,projectId:n}=e,[c,u]=(0,s.useState)([]);(0,s.useEffect)(()=>{if(t||!n)return;let e=(0,r.hJ)(l.db,"projects",n,"tasks"),a=(0,r.IO)(e,(0,r.Xo)("endDate","asc")),s=(0,r.cf)(a,e=>{u(e.docs.map(e=>({id:e.id,...e.data()})))},()=>(0,r.cf)(e,e=>{u(e.docs.map(e=>({id:e.id,...e.data()})))}));return()=>s()},[t,n]);let h=null!=t?t:c,{days:x,planned:m,actual:f,maxY:g}=(0,s.useMemo)(()=>{if(!h||0===h.length)return{days:[],planned:[],actual:[],maxY:0};let e=[],t=[];for(let s of h){var n,a;let l=i(null!==(n=s.endDate)&&void 0!==n?n:s.end);l&&e.push(o(l));let r=(s.status||"").toLowerCase(),d="done"===r||"completed"===r,c=null!==(a=i(s.actualEnd))&&void 0!==a?a:d?l:void 0;c&&t.push(o(c))}if(0===e.length&&0===t.length)return{days:[],planned:[],actual:[],maxY:0};e.sort((e,t)=>e.getTime()-t.getTime()),t.sort((e,t)=>e.getTime()-t.getTime());let s=new Date(Math.min(e.length?e[0].getTime():1/0,t.length?t[0].getTime():1/0)),l=new Date(Math.max(e.length?e[e.length-1].getTime():-1/0,t.length?t[t.length-1].getTime():-1/0));if(!(s.getTime()<=l.getTime()))return{days:[],planned:[],actual:[],maxY:0};let r=[],c=o(s);for(;c<=l;)r.push(new Date(c)),c=function(e,t){let n=new Date(e);return n.setDate(n.getDate()+1),n}(c,0);let u=new Map;for(let t of e){let e=d(t);u.set(e,(u.get(e)||0)+1)}let x=new Map;for(let e of t){let t=d(e);x.set(t,(x.get(t)||0)+1)}let m=[],f=[],g=0,p=0;for(let e of r){let t=d(e);g+=u.get(t)||0,p+=x.get(t)||0,m.push(g),f.push(p)}let j=Math.max(m.at(-1)||0,f.at(-1)||0);return{days:r,planned:m,actual:f,maxY:j}},[h]);if(!t&&!n)return(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Provide tasks or a projectId to render the S-Curve."});if(!h||0===h.length)return(0,a.jsx)("div",{className:"rounded border border-dashed p-4 text-sm text-gray-500",children:"No tasks with finish dates found. Import a schedule or add tasks to see the S-Curve."});let p=e=>e/Math.max(1,x.length-1)*840,j=e=>268-e/Math.max(1,g)*268,y=0===m.length?"":m.map((e,t)=>"".concat(0===t?"M":"L"," ").concat(p(t).toFixed(2)," ").concat(j(e).toFixed(2))).join(" "),b=0===f.length?"":f.map((e,t)=>"".concat(0===t?"M":"L"," ").concat(p(t).toFixed(2)," ").concat(j(e).toFixed(2))).join(" "),v=Math.min(8,Math.max(1,x.length-1));return(0,a.jsxs)("div",{className:"overflow-auto rounded border bg-white p-3",children:[(0,a.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"S-Curve (Cumulative Planned vs Actual)"}),(0,a.jsxs)("div",{className:"flex items-center gap-3 text-xs",children:[(0,a.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,a.jsx)("span",{className:"inline-block h-2 w-4 rounded-sm bg-blue-600"})," Planned"]}),(0,a.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,a.jsx)("span",{className:"inline-block h-2 w-4 rounded-sm bg-green-600"})," Actual"]})]})]}),(0,a.jsx)("svg",{width:900,height:320,role:"img","aria-label":"S-Curve chart",children:(0,a.jsxs)("g",{transform:"translate(".concat(44,",").concat(16,")"),children:[Array.from({length:6},(e,t)=>{let n=t/5*g,s=j(n);return(0,a.jsxs)("g",{children:[(0,a.jsx)("line",{x1:0,x2:840,y1:s,y2:s,stroke:"#e5e7eb"}),(0,a.jsx)("text",{x:-8,y:s,textAnchor:"end",dominantBaseline:"middle",fontSize:"10",fill:"#6b7280",children:Math.round(n)})]},"y-".concat(t))}),Array.from({length:v+1},(e,t)=>{let n=Math.round(t/v*(x.length-1)),s=x[n],l=p(n);return(0,a.jsxs)("g",{children:[(0,a.jsx)("line",{x1:l,x2:l,y1:0,y2:268,stroke:"#f3f4f6"}),(0,a.jsx)("text",{x:l,y:284,textAnchor:"middle",fontSize:"10",fill:"#6b7280",children:s.toLocaleDateString()})]},"x-".concat(t))}),(0,a.jsx)("line",{x1:0,x2:840,y1:268,y2:268,stroke:"#9ca3af"}),(0,a.jsx)("line",{x1:0,x2:0,y1:0,y2:268,stroke:"#9ca3af"}),(0,a.jsx)("path",{d:y,fill:"none",stroke:"#2563eb",strokeWidth:2}),(0,a.jsx)("path",{d:b,fill:"none",stroke:"#16a34a",strokeWidth:2})]})})]})}}}]);